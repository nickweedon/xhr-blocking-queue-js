/*! xhr-blocking-queue-js 2016-05-02 */
define("xhr-blocking-queue-js",["xhr-adaptor-js"],function(a){function b(a,b){b=void 0===b?!0:b;for(var c=a.eventQueue;null!==c&&c.length>0;){var d=c.shift();b&&d()}a.eventQueue=null}function c(a,c,d){return function(e){e=void 0===e?!0:e,e&&a.applyRealHandler(d),b(a._xhr,e),c.isBlocked=!1;var f=g.BlockingRequestQueueXHR.prototype.requestQueue;if(void 0!==f)for(;f.length>0;){var h=g.BlockingRequestQueueXHR.prototype.requestQueue.shift();h()}}}function d(a){for(var b in this.responseHandlerMap)if(this.responseHandlerMap.hasOwnProperty(b)&&new RegExp(b,"g").test(a))return Object.getPrototypeOf(this).responseHandlerMap[b];return null}function e(a){var e=this;if(this._xhr.bypassFilter)return e.applyRealHandler(a),void b(e._xhr);var f=d.call(this._xhr,this._xhr.getRequestURL());if(null===f)return e.applyRealHandler(a),void b(e._xhr);if(f.isBlocked)return this._xhr.resend(),void console.debug("Failed to catch blocked request in time, ignoring response and adding request to queue.");try{f.invokeHandler(this,a)}catch(g){console.error("Exception thrown in BlockingRequestQueue response handler:",g),doContinue=c(this,f,a),doContinue(!1)}}var f=a,g=g||{},g=g||{};return g.BlockingRequestQueueXHR=function(a){this.openArgs=null,this.requestHeaders={},f.XHRWrapper.prototype.constructor.call(this,a)},g.BlockingRequestQueueXHR.prototype=Object.create(f.XHRWrapper.prototype),g.BlockingRequestQueueXHR.constructor=g.BlockingRequestQueueXHR,g.BlockingRequestQueueXHR.prototype.responseHandlerMap={},g.BlockingRequestQueueXHR.prototype.requestQueue=[],g.BlockingRequestQueueXHR.prototype.open=function(){this.requestHeaders={},this.openArgs=arguments,f.XHRWrapper.prototype.open.apply(this,this.openArgs)},g.BlockingRequestQueueXHR.prototype.send=function(){var a=this,b=arguments;this.sendArgs=b;var c=d.call(this,this.getRequestURL());return!this.bypassFilter&&null!==c&&c.isBlocked?void g.BlockingRequestQueueXHR.prototype.requestQueue.push(function(){f.XHRWrapper.prototype.send.apply(a,b)}):void f.XHRWrapper.prototype.send.apply(a,b)},g.BlockingRequestQueueXHR.prototype.resend=function(){var a=this.getAllRequestHeaders();this.open.apply(this,this.openArgs),this.addRequestHeaders(a),this.send.apply(this,this.sendArgs)},g.BlockingRequestQueueXHR.prototype.setRequestHeader=function(a,b){var c=a.toLowerCase();if(c in this.requestHeaders){var d=this.requestHeaders[c];d.push(b)}else this.requestHeaders[c]=[b];f.XHRWrapper.prototype.setRequestHeader.apply(this,arguments)},g.BlockingRequestQueueXHR.prototype.getRequestHeaders=function(a){var b=a.toLowerCase();return b in this.requestHeaders?this.requestHeaders[b]:[]},g.BlockingRequestQueueXHR.prototype.getAllRequestHeaders=function(){return this.requestHeaders},g.BlockingRequestQueueXHR.prototype.requestHeaderContains=function(a,b){var c=a.toLowerCase();return c in this.requestHeaders?-1!=this.requestHeaders[c].indexOf(b):!1},g.BlockingRequestQueueXHR.prototype.isRequestHeaderSet=function(a){var b=a.toLowerCase();return b in this.requestHeaders},g.BlockingRequestQueueXHR.prototype.addRequestHeaders=function(a){if(null!==a)for(var b in a)if(a.hasOwnProperty(b))for(var c=a[b],d=0;d<c.length;d++)this.setRequestHeader(b,c[d])},g.BlockingRequestQueueXHR.prototype.getRequestURL=function(){return null===this.openArgs||this.openArgs.length<2?null:this.openArgs[1]},g.BlockingRequestQueueXHR.prototype.getRequestVerb=function(){return null===this.openArgs||this.openArgs.length<1?null:this.openArgs[0]},g.BlockingRequestQueueXHR.prototype.registerResponseHandler=function(a,b,d){if(a in g.BlockingRequestQueueXHR.prototype.responseHandlerMap)return void console.error("Attempted to register handler for existing regex expression '"+a+"'");var e=this,f={handler:b,context:d||e,isBlocked:!1,invokeHandler:function(a,b){f.isBlocked=!0,f.handler.call(d,c(a,f,b),a._xhr)}};g.BlockingRequestQueueXHR.prototype.responseHandlerMap[a]=f},g.BlockingRequestQueueXHR.registerResponseHandler=g.BlockingRequestQueueXHR.prototype.registerResponseHandler,g.BlockingRequestQueueXHR.prototype.unregisterResponseHandler=function(a){delete g.BlockingRequestQueueXHR.prototype.responseHandlerMap[a]},g.BlockingRequestQueueXHR.unregisterResponseHandler=g.BlockingRequestQueueXHR.prototype.unregisterResponseHandler,g.BlockingRequestQueueXHR.prototype.clearResponseHandlers=function(){g.BlockingRequestQueueXHR.prototype.responseHandlerMap={}},g.BlockingRequestQueueXHR.clearResponseHandlers=g.BlockingRequestQueueXHR.prototype.clearResponseHandlers,g.BlockingRequestQueueXHR.prototype.eventDelegate={onreadystatechange:function(){var a=arguments,b=this._xhr;return 1==b.readyState?void(this._xhr.eventQueue=[]):void(4==b.readyState?(this._xhr.isProcessed=!0,e.call(this,a)):this.applyRealHandler(a))},onload:function(){var a=this,b=arguments;return null===this._xhr.eventQueue?void this.applyRealHandler(b):void this._xhr.eventQueue.push(function(){a.applyRealHandler(b)})}},g});